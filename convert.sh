#!/bin/bash
set -euo pipefail
# Check if the system is a Mac
if [[ "$OSTYPE" == "darwin"* ]]; then
    FONTFORGE_BIN="/Applications/FontForge.app/Contents/Resources/opt/local/bin/fontforge"
    if [[ ! -x "$FONTFORGE_BIN" ]]; then
        echo "FontForge binary not found in FontForge.app package."
        exit 1
    fi
else
    FONTFORGE_BIN="fontforge"
fi

# Run FontForge with the provided arguments
$FONTFORGE_BIN -lang=ff -c 'Open($1); Generate($2)' sources/Mezenets.sfd sources/Mezenets-Regular.ufo

# Dirty hack to add the openTypeOS2Selection key to the fontinfo.plist file
FONTINFO=`cat sources/Mezenets-Regular.ufo/fontinfo.plist`
echo "${FONTINFO/    <key>openTypeOS2Type<\/key>/    <key>openTypeOS2Selection</key>$'\n'    <array>$'\n'      <integer>7</integer>$'\n'    </array>$'\n'    <key>openTypeOS2Type</key>}" > sources/Mezenets-Regular.ufo/fontinfo.plist

# Create the color data
printf 'colorizing your font... (this may take a while)\n'
# Bug warning: This is a temporary hack, contingent on the glif filenames exported by FontForge staying the same
# We should rewrite this using python scripts and actual glyph names
mkdir -p sources/Mezenets-Regular.ufo/glyphs.color0/
cp sources/lib.plist sources/Mezenets-Regular.ufo/lib.plist
cp sources/color0.contents.plist sources/Mezenets-Regular.ufo/glyphs.color0/contents.plist
cp sources/layercontents.plist sources/Mezenets-Regular.ufo/layercontents.plist

# list of glyphs that need to be colorized
COLORIZE=( u1C_F_00.glif u1C_F_01.glif u1C_F_02.glif u1C_F_03.glif u1C_F_04.glif u1C_F_05.glif u1C_F_06.glif u1C_F_07.glif u1C_F_08.glif u1C_F_09.glif u1C_F_0A_.glif u1C_F_0B_.glif u1C_F_0C_.glif u1C_F_0D_.glif u1C_F_0E_.glif u1C_F_0F_.glif u1C_F_10.glif u1C_F_11.glif u1C_F_12.glif u1C_F_13.glif u1C_F_14.glif u1C_F_15.glif u1C_F_16.glif u1C_F_17.glif u1C_F_18.glif u1C_F_19.glif u1C_F_1A_.glif u1C_F_1B_.glif u1C_F_1C_.glif u1C_F_1D_.glif u1C_F_1E_.glif u1C_F_1F_.glif u1C_F_20.glif u1C_F_21.glif u1C_F_22.glif u1C_F_23.glif u1C_F_24.glif u1C_F_25.glif u1C_F_26.glif u1C_F_27.glif u1C_F_28.glif u1C_F_29.glif u1C_F_2A_.glif u1C_F_2B_.glif u1C_F_2C_.glif u1C_F_2D_.glif uniE_A_00.glif uniE_A_01.glif uniE_A_02.glif uniE_A_03.glif uniE_A_04.glif uniE_A_05.glif uniE_A_06.glif uniE_A_07.glif uniE_A_08.glif uniE_A_10.glif uniE_A_11.glif uniE_A_12.glif uniE_A_13.glif uniE_A_14.glif uniE_A_15.glif uniE_A_18.glif uniE_A_20.glif uniE_A_21.glif uniE_A_22.glif uniE_A_23.glif uniE_A_24.glif uniE_A_25.glif uniE_A_26.glif uniE_A_27.glif uniE_A_28.glif uniE_A_29.glif uniE_A_2A_.glif uniE_A_2B_.glif uniE_A_2C_.glif uniE_A_2D_.glif uniE_A_30.glif uniE_A_31.glif uniE_A_32.glif uniE_A_33.glif uniE_A_34.glif uniE_A_35.glif uniE_A_36.glif uniE_A_37.glif uniE_A_38.glif uniE_A_39.glif uniE_A_3A_.glif uniE_A_3B_.glif uniE_A_3C_.glif uniE_A_3D_.glif uniE_A_3E_.glif uniE_A_3F_.glif uniE_A_40.glif uniE_A_41.glif uniE_A_2D_.glif uniE_A_42.glif uniE_A_43.glif )
for glif in "${COLORIZE[@]}"; do
    [[ -n "$glif" ]] || continue
    src="sources/Mezenets-Regular.ufo/glyphs/$glif"
    if [[ -e "$src" ]]; then
        cp -- "$src" "sources/Mezenets-Regular.ufo/glyphs.color0/"
    else
        printf 'warning: %s not found\n' "$src" >&2
    fi
done

# now we have the glyphs that have color components
# the first element is the character's glyph file and the second is the red component's file
PAIRS="uniF_400.glif:uniE_A_46.glif uniF_401.glif:uniE_A_47.glif uniF_402.glif:uniE_A_46.glif uniF_403.glif:uniE_A_47.glif uniF_404.glif:uniE_A_46.glif uniF_405.glif:uniE_A_47.glif uniF_406.glif:uniE_A_46.glif uniF_407.glif:uniE_A_47.glif uniF_40A_.glif:uniE_A_46.glif uniF_40B_.glif:uniE_A_48.glif uniF_40C_.glif:uniE_A_46.glif uniF_40D_.glif:uniE_A_48.glif uniF_40E_.glif:uniE_A_46.glif uniF_40F_.glif:uniE_A_48.glif uniF_412.glif:uniE_A_46.glif uniF_413.glif:uniE_A_47.glif uniF_414.glif:uniE_A_46.glif uniF_415.glif:uniE_A_47.glif uniF_416.glif:uniE_A_46.glif uniF_417.glif:uniE_A_47.glif uniF_41A_.glif:uniE_A_46.glif uniF_41B_.glif:uniE_A_47.glif uniF_41C_.glif:uniE_A_46.glif uniF_41D_.glif:uniE_A_47.glif uniF_41E_.glif:uniE_A_46.glif uniF_41F_.glif:uniE_A_47.glif uniF_420.glif:uniE_A_46.glif uniF_421.glif:uniE_A_47.glif uniF_422.glif:uniE_A_46.glif uniF_423.glif:uniE_A_47.glif uniF_424.glif:uniE_A_46.glif uniF_425.glif:uniE_A_47.glif uniF_426.glif:uniE_A_46.glif uniF_427.glif:uniE_A_47.glif uniF_428.glif:uniE_A_46.glif uniF_429.glif:uniE_A_47.glif uniF_42C_.glif:uniF_61C_.glif uniF_42D_.glif:uniF_61C_.glif uniF_42E_.glif:uniF_61C_.glif uniF_431.glif:uniE_A_46.glif uniF_432.glif:uniE_A_47.glif uniF_433.glif:uniE_A_49.glif uniF_434.glif:uniE_A_46.glif uniF_435.glif:uniE_A_47.glif uniF_436.glif:uniE_A_46.glif uniF_437.glif:uniE_A_47.glif uniF_438.glif:uniE_A_46.glif uniF_439.glif:uniE_A_47.glif uniF_43A_.glif:uniE_A_46.glif uniF_43B_.glif:uniE_A_47.glif uniF_43E_.glif:uniE_A_46.glif uniF_43F_.glif:uniE_A_47.glif uniF_442.glif:uniE_A_46.glif uniF_443.glif:uniE_A_47.glif uniF_444.glif:uniE_A_46.glif uniF_445.glif:uniE_A_47.glif uniF_446.glif:uniE_A_46.glif uniF_447.glif:uniE_A_47.glif uniF_448.glif:uniE_A_46.glif uniF_449.glif:uniE_A_47.glif uniF_44C_.glif:uniE_A_46.glif uniF_450.glif:uniE_A_47.glif uniF_44D_.glif:uniE_A_46.glif uniF_44E_.glif:uniE_A_47.glif uniF_451.glif:uniE_A_46.glif uniF_44F_.glif:uniE_A_47.glif uniF_454.glif:uniF_61C_.glif uniF_455.glif:uniF_61C_.glif uniF_456.glif:uniF_61C_.glif uniF_457.glif:uniF_61C_.glif uniF_459.glif:uniE_A_45.glif uniF_45A_.glif:uniE_A_45.glif uniF_45D_.glif:uniE_A_4A_.glif uniF_45E_.glif:uniE_A_4B_.glif uniF_45F_.glif:uniE_A_4A_.glif uniF_460.glif:uniE_A_4B_.glif uniF_461.glif:uniE_A_4C_.glif uniF_462.glif:uniE_A_4C_.glif uniF_465.glif:uniE_A_4C_.glif uniF_466.glif:uniE_A_4D_.glif uniF_467.glif:uniE_A_4C_.glif uniF_468.glif:uniE_A_4D_.glif uniF_469.glif:uniE_A_4C_.glif uniF_46A_.glif:uniE_A_4D_.glif uniF_46B_.glif:uniE_A_4C_.glif uniF_46C_.glif:uniE_A_4D_.glif uniF_46D_.glif:uniE_A_4C_.glif uniF_46E_.glif:uniE_A_4D_.glif uniF_46F_.glif:uniE_A_4C_.glif uniF_470.glif:uniE_A_4D_.glif uniF_471.glif:uniE_A_4C_.glif uniF_472.glif:uniE_A_4D_.glif uniF_473.glif:uniE_A_4C_.glif uniF_474.glif:uniE_A_4D_.glif uniF_475.glif:uniE_A_4C_.glif uniF_476.glif:uniE_A_4D_.glif uniF_479.glif:uniE_A_4C_.glif uniF_47A_.glif:uniE_A_4D_.glif uniF_47B_.glif:uniE_A_4C_.glif uniF_47C_.glif:uniE_A_4D_.glif uniF_47D_.glif:uniE_A_4C_.glif uniF_47E_.glif:uniE_A_4D_.glif uniF_487.glif:uniE_A_4C_.glif uniF_488.glif:uniE_A_4D_.glif uniF_489.glif:uniE_A_4C_.glif uniF_48A_.glif:uniE_A_4D_.glif uniF_48B_.glif:uniE_A_4C_.glif uniF_48C_.glif:uniE_A_4D_.glif uniF_48F_.glif:uniE_A_4C_.glif uniF_490.glif:uniE_A_4D_.glif uniF_491.glif:uniE_A_4C_.glif uniF_492.glif:uniE_A_4D_.glif uniF_493.glif:uniE_A_4C_.glif uniF_494.glif:uniE_A_4D_.glif uniF_497.glif:uniE_A_4C_.glif uniF_498.glif:uniE_A_4D_.glif uniF_499.glif:uniE_A_4C_.glif uniF_49A_.glif:uniE_A_4D_.glif uniF_49B_.glif:uniE_A_4C_.glif uniF_49C_.glif:uniE_A_4D_.glif uniF_49F_.glif:uniE_A_4C_.glif uniF_4A_0.glif:uniE_A_4D_.glif uniF_4A_1.glif:uniE_A_4C_.glif uniF_4A_2.glif:uniE_A_4D_.glif uniF_4A_3.glif:uniE_A_4C_.glif uniF_4A_4.glif:uniE_A_4D_.glif uniF_4A_7.glif:uniE_A_4C_.glif uniF_4A_8.glif:uniE_A_4D_.glif uniF_4A_9.glif:uniE_A_4C_.glif uniF_4A_A_.glif:uniE_A_4D_.glif uniF_4A_B_.glif:uniE_A_4C_.glif uniF_4A_C_.glif:uniE_A_4D_.glif uniF_4A_F_.glif:uniE_A_4C_.glif uniF_4B_0.glif:uniE_A_4D_.glif uniF_4B_1.glif:uniE_A_4C_.glif uniF_4B_2.glif:uniE_A_4D_.glif uniF_4B_3.glif:uniE_A_4C_.glif uniF_4B_4.glif:uniE_A_4D_.glif uniF_4B_7.glif:uniE_A_4C_.glif uniF_4B_8.glif:uniE_A_4D_.glif uniF_4B_9.glif:uniE_A_4C_.glif uniF_4B_A_.glif:uniE_A_4D_.glif uniF_4B_B_.glif:uniE_A_4C_.glif uniF_4B_C_.glif:uniE_A_4D_.glif uniF_4B_F_.glif:uniE_A_4C_.glif uniF_4C_0.glif:uniE_A_4D_.glif uniF_4C_1.glif:uniE_A_4C_.glif uniF_4C_2.glif:uniE_A_4D_.glif uniF_4C_3.glif:uniE_A_4C_.glif uniF_4C_4.glif:uniE_A_4D_.glif uniF_4C_6.glif:uniE_A_4E_.glif uniF_4C_8.glif:uniE_A_46.glif uniF_4C_9.glif:uniE_A_4F_.glif uniF_4C_A_.glif:uniE_A_46.glif uniF_4C_B_.glif:uniE_A_4F_.glif uniF_4C_C_.glif:uniE_A_46.glif uniF_4C_D_.glif:uniE_A_4F_.glif uniF_4C_E_.glif:uniE_A_46.glif uniF_4C_F_.glif:uniE_A_4F_.glif uniF_4D_2.glif:uniE_A_46.glif uniF_4D_3.glif:uniE_A_4F_.glif uniF_4D_6.glif:uniE_A_46.glif uniF_4D_7.glif:uniE_A_4F_.glif uniF_4D_8.glif:uniE_A_46.glif uniF_4D_9.glif:uniE_A_4F_.glif uniF_4D_A_.glif:uniE_A_46.glif uniF_4D_B_.glif:uniE_A_4F_.glif uniF_4D_E_.glif:uniE_A_46.glif uniF_4D_F_.glif:uniE_A_4F_.glif uniF_4E_2.glif:uniE_A_46.glif uniF_4E_3.glif:uniE_A_4F_.glif uniF_4E_4.glif:uniE_A_46.glif uniF_4E_5.glif:uniE_A_4F_.glif uniF_4E_6.glif:uniE_A_46.glif uniF_4E_7.glif:uniE_A_4F_.glif uniF_4E_8.glif:uniE_A_46.glif uniF_4E_9.glif:uniE_A_4F_.glif uniF_4E_C_.glif:uniE_A_46.glif uniF_4E_D_.glif:uniE_A_4F_.glif uniF_4E_E_.glif:uniE_A_46.glif uniF_4E_F_.glif:uniE_A_4F_.glif uniF_4F_0.glif:uniE_A_46.glif uniF_4F_1.glif:uniE_A_4F_.glif uniF_4F_4.glif:uniE_A_46.glif uniF_4F_5.glif:uniE_A_4F_.glif uniF_4F_8.glif:uniE_A_46.glif uniF_4F_9.glif:uniE_A_4F_.glif uniF_4F_C_.glif:uniE_A_46.glif uniF_4F_D_.glif:uniE_A_4F_.glif uniF_4F_E_.glif:uniE_A_46.glif uniF_4F_F_.glif:uniE_A_4F_.glif uniF_500.glif:uniE_A_46.glif uniF_501.glif:uniE_A_4F_.glif uniF_504.glif:uniE_A_46.glif uniF_505.glif:uniE_A_4F_.glif uniF_506.glif:uniE_A_46.glif uniF_507.glif:uniE_A_4F_.glif uniF_508.glif:uniE_A_46.glif uniF_509.glif:uniE_A_4F_.glif uniF_50C_.glif:uniE_A_46.glif uniF_50D_.glif:uniE_A_4F_.glif uniF_510.glif:uniE_A_46.glif uniF_511.glif:uniE_A_4F_.glif uniF_514.glif:uniF_615.glif uniF_515.glif:uniF_616.glif uniF_516.glif:uniF_615.glif uniF_517.glif:uniF_616.glif uniF_518.glif:uniF_615.glif uniF_519.glif:uniF_616.glif uniF_51A_.glif:uniF_615.glif uniF_51B_.glif:uniF_616.glif uniF_51C_.glif:uniF_615.glif uniF_51D_.glif:uniF_616.glif uniF_51E_.glif:uniF_615.glif uniF_51F_.glif:uniF_616.glif uniF_520.glif:uniF_615.glif uniF_521.glif:uniF_616.glif uniF_522.glif:uniF_615.glif uniF_523.glif:uniF_616.glif uniF_524.glif:uniF_615.glif uniF_525.glif:uniF_616.glif uniF_526.glif:uniF_615.glif uniF_527.glif:uniF_616.glif uniF_528.glif:uniF_615.glif uniF_529.glif:uniF_616.glif uniF_52A_.glif:uniF_615.glif uniF_52B_.glif:uniF_616.glif uniF_52C_.glif:uniF_615.glif uniF_52D_.glif:uniF_616.glif uniF_52E_.glif:uniF_615.glif uniF_52F_.glif:uniF_616.glif uniF_530.glif:uniF_615.glif uniF_531.glif:uniF_616.glif uniF_538.glif:uniF_617.glif uniF_539.glif:uniF_618.glif uniF_53A_.glif:uniF_617.glif uniF_53B_.glif:uniF_618.glif uniF_53C_.glif:uniF_617.glif uniF_53D_.glif:uniF_618.glif uniF_53E_.glif:uniF_617.glif uniF_53F_.glif:uniF_618.glif uniF_540.glif:uniF_617.glif uniF_541.glif:uniF_618.glif uniF_544.glif:uniF_617.glif uniF_545.glif:uniF_618.glif uniF_546.glif:uniF_617.glif uniF_547.glif:uniF_618.glif uniF_548.glif:uniF_617.glif uniF_549.glif:uniF_618.glif uniF_54C_.glif:uniF_617.glif uniF_54D_.glif:uniF_618.glif uniF_54E_.glif:uniF_617.glif uniF_54F_.glif:uniF_618.glif uniF_550.glif:uniF_617.glif uniF_551.glif:uniF_618.glif uniF_554.glif:uniF_617.glif uniF_555.glif:uniF_618.glif uniF_556.glif:uniF_617.glif uniF_557.glif:uniF_618.glif uniF_55A_.glif:uniF_617.glif uniF_55B_.glif:uniF_618.glif uniF_55C_.glif:uniF_617.glif uniF_55D_.glif:uniF_618.glif uniF_560.glif:uniF_617.glif uniF_561.glif:uniF_618.glif uniF_564.glif:uniF_617.glif uniF_565.glif:uniF_618.glif uniF_566.glif:uniF_617.glif uniF_567.glif:uniF_618.glif uniF_568.glif:uniF_617.glif uniF_569.glif:uniF_618.glif uniF_56A_.glif:uniF_617.glif uniF_56B_.glif:uniF_618.glif uniF_56C_.glif:uniF_617.glif uniF_56D_.glif:uniF_618.glif uniF_56E_.glif:uniF_617.glif uniF_56F_.glif:uniF_618.glif uniF_570.glif:uniF_617.glif uniF_571.glif:uniF_618.glif uniF_574.glif:uniF_617.glif uniF_575.glif:uniF_618.glif uniF_576.glif:uniF_617.glif uniF_577.glif:uniF_618.glif uniF_578.glif:uniF_617.glif uniF_579.glif:uniF_618.glif uniF_57C_.glif:uniF_617.glif uniF_57D_.glif:uniF_618.glif uniF_580.glif:uniF_617.glif uniF_581.glif:uniF_618.glif uniF_582.glif:uniF_617.glif uniF_583.glif:uniF_618.glif uniF_586.glif:uniF_617.glif uniF_587.glif:uniF_618.glif uniF_58A_.glif:uniF_619.glif uniF_58B_.glif:uniF_61A_.glif uniF_58C_.glif:uniF_619.glif uniF_58D_.glif:uniF_61A_.glif uniF_58E_.glif:uniF_619.glif uniF_58F_.glif:uniF_61A_.glif uniF_590.glif:uniF_619.glif uniF_591.glif:uniF_61A_.glif uniF_598.glif:uniF_619.glif uniF_599.glif:uniF_61A_.glif uniF_59C_.glif:uniF_619.glif uniF_59D_.glif:uniF_61A_.glif uniF_59E_.glif:uniF_619.glif uniF_59F_.glif:uniF_61A_.glif uniF_5A_0.glif:uniF_619.glif uniF_5A_1.glif:uniF_61A_.glif uniF_5A_2.glif:uniF_619.glif uniF_5A_3.glif:uniF_61A_.glif uniF_5A_4.glif:uniF_619.glif uniF_5A_5.glif:uniF_61A_.glif uniF_5A_6.glif:uniF_619.glif uniF_5A_7.glif:uniF_61A_.glif uniF_5A_8.glif:uniF_619.glif uniF_5A_9.glif:uniF_61A_.glif uniF_5A_A_.glif:uniF_619.glif uniF_5A_B_.glif:uniF_61A_.glif uniF_5A_C_.glif:uniF_619.glif uniF_5A_D_.glif:uniF_61A_.glif uniF_5A_E_.glif:uniF_619.glif uniF_5A_F_.glif:uniF_61A_.glif uniF_5B_0.glif:uniF_619.glif uniF_5B_1.glif:uniF_61A_.glif uniF_5B_2.glif:uniF_619.glif uniF_5B_3.glif:uniF_61A_.glif uniF_5B_6.glif:uniF_619.glif uniF_5B_7.glif:uniF_61A_.glif uniF_5B_A_.glif:uniF_619.glif uniF_5B_B_.glif:uniF_61A_.glif uniF_5B_E_.glif:uniF_61B_.glif uniF_5B_F_.glif:uniE_A_47.glif uniF_5C_0.glif:uniF_61B_.glif uniF_5C_1.glif:uniE_A_47.glif uniF_5C_2.glif:uniF_61B_.glif uniF_5C_3.glif:uniE_A_47.glif uniF_5C_4.glif:uniF_61B_.glif uniF_5C_5.glif:uniE_A_47.glif uniF_5C_C_.glif:uniF_61B_.glif uniF_5C_D_.glif:uniE_A_47.glif uniF_5D_0.glif:uniF_61B_.glif uniF_5D_1.glif:uniE_A_47.glif uniF_5D_2.glif:uniF_61B_.glif uniF_5D_3.glif:uniE_A_47.glif uniF_5D_4.glif:uniF_61B_.glif uniF_5D_5.glif:uniE_A_47.glif uniF_5D_6.glif:uniF_61B_.glif uniF_5D_7.glif:uniE_A_47.glif uniF_5D_8.glif:uniF_61B_.glif uniF_5D_9.glif:uniE_A_47.glif uniF_5D_A_.glif:uniF_61B_.glif uniF_5D_B_.glif:uniE_A_47.glif uniF_5D_C_.glif:uniF_61B_.glif uniF_5D_D_.glif:uniE_A_47.glif uniF_5D_E_.glif:uniF_61B_.glif uniF_5D_F_.glif:uniE_A_47.glif uniF_5E_0.glif:uniF_61B_.glif uniF_5E_1.glif:uniE_A_47.glif uniF_5E_2.glif:uniF_61B_.glif uniF_5E_3.glif:uniE_A_47.glif uniF_5E_4.glif:uniF_61B_.glif uniF_5E_5.glif:uniE_A_47.glif uniF_5E_6.glif:uniF_61B_.glif uniF_5E_7.glif:uniE_A_47.glif uniF_5E_A_.glif:uniF_61B_.glif uniF_5E_B_.glif:uniE_A_47.glif uniF_5E_E_.glif:uniF_61B_.glif uniF_5E_F_.glif:uniE_A_47.glif uniF_5F_5.glif:uniE_A_46.glif uniF_5F_8.glif:uniE_A_46.glif uniF_5F_9.glif:uniE_A_46.glif uniF_5F_A_.glif:uniE_A_46.glif uniF_5F_C_.glif:uniE_A_46.glif uniF_5F_D_.glif:uniE_A_46.glif uniF_5F_E_.glif:uniE_A_46.glif uniF_601.glif:uniE_A_46.glif uniF_602.glif:uniE_A_46.glif uniF_603.glif:uniE_A_46.glif uniF_606.glif:uniE_A_46.glif uniF_607.glif:uniE_A_46.glif uniF_608.glif:uniE_A_46.glif uniF_60B_.glif:uniE_A_46.glif uniF_60C_.glif:uniE_A_47.glif uniF_60D_.glif:uniE_A_46.glif uniF_60E_.glif:uniE_A_47.glif uniF_60F_.glif:uniE_A_46.glif uniF_610.glif:uniE_A_47.glif uniF_611.glif:uniE_A_46.glif uniF_612.glif:uniE_A_47.glif uniF_613.glif:uniF_61C_.glif uniE_A_5E_.glif:uniF_619.glif uniE_A_5F_.glif:uniE_A_47.glif"
for pair in $PAIRS; do
    IFS=: read -r charname compname <<<"$pair"
    src="sources/Mezenets-Regular.ufo/glyphs/$compname"
    dst="sources/Mezenets-Regular.ufo/glyphs.color0/$charname"

    if [[ -e "$src" ]]; then
        cp -- "$src" "$dst"
    else
        printf 'warning: %s not found\n' "$src" >&2
    fi
done
